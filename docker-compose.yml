version: '3.8'
volumes:
  korerorero-voice-service-cache:
    external: true
services:
  front-end:
    image: korerorero-front-end:v0.3.1
    container_name: nzcodarnoc-korerorero-front-end
    env_file:
      - front-end.env
    build:
      context: https://github.com/nzcodarnoc/korerorero-front-end.git#v0.3.1
    volumes:
      - ./build:/build
    networks:
      - default
  tts:
    image: korerorero-tts:v1.0.1
    container_name: nzcodarnoc-korerorero-tts
    build:
      context: https://github.com/nzcodarnoc/korerorero-marytts.git#v1.0.1
    volumes:
      - ./build:/build
    networks:
      - default
  voice-service:
    image: korerorero-voice-service:dev
    container_name: nzcodarnoc-korerorero-voice-service
    build:
      context: ../korerorero-voice-service
    user: "1000:1000" # this sets the owner of the /voice-cache mount
    volumes:
      - korerorero-voice-service-cache:/voice-cache:rw
    networks:
      - default
    env_file:
      - voice-service.env
    links:
      - mouth-shapes
  speech-recognition:
    image: korerorero-speech-recognition:v0.1.0
    container_name: nzcodarnoc-korerorero-speech-recognition
    build:
      context: https://github.com/nzcodarnoc/korerorero-speech-recognition.git#v0.1.0
    volumes:
      - ./build:/build
    networks:
      - default      
  orchestration:
    image: korerorero-orchestration:v0.2.0
    container_name: nzcodarnoc-korerorero-orchestration
    env_file:
      - orchestration.env
      - ibm-credentials.env
    build:
      context: https://github.com/nzcodarnoc/korerorero-orchestration.git#v0.2.0
    volumes:
      - ./build:/build
    networks:
      - default      
    links:
      - voice-service
  mouth-shapes:
    image: korerorero-mouth-shapes:v0.1.1
    container_name: nzcodarnoc-korerorero-mouth-shapes
    env_file:
      - mouth-shapes.env
    build:
     context: https://github.com/nzcodarnoc/korerorero-mouth-shapes.git#v0.1.1
    volumes:
      - ./build:/build               
    networks:
      - default  
    links:
      - tts      
  proxy:
    image: korerorero-reverse-proxy:v0.3.2
    container_name: nzcodarnoc-korerorero-reverse-proxy
    build:
      context: ./
      dockerfile: Dockerfile.proxy
    env_file:
      - .env
    networks:
      - default
    links:
      - front-end
      - orchestration
      - speech-recognition
    ports:
      - "${PORT}:${PORT}"
